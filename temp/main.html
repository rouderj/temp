<!DOCTYPE html>
<html>
<head>
    <title>Psychology Experiment</title>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js'></script>
    <script src="../lib/dist-7.1.2/jspsych.js"></script>
    <script src="../lib/dist-7.1.2/plugin-html-keyboard-response.js"></script>
    <script src="../lib/dist-7.1.2/plugin-audio-keyboard-response.js"></script>
    <script src="../lib/dist-7.1.2/plugin-audio-button-response.js"></script>
    <script src="../lib/dist-7.1.2/plugin-preload.js"></script>
    <script src="../lib/dist-7.1.2/plugin-fullscreen.js"></script>
      <script src="../lib/dist-7.1.2/plugin-browser-check.js"></script>
    <script src="./js/local.js"></script>
    <script src="./js/ml.js"></script>
    <script src="./js/pog.js"></script>
    <script src="./js/flank.js"></script>
    <script src="./js/pz.js"></script>
    <script src="./js/tilt.js"></script>
    <script src="./js/jspsych-psychophysics.js"></script>
    <script src="./js/math.js"></script>
    <link rel="stylesheet" href="./css/jspsych.css"></link>
</head>
<body style="background-color:white;"></body>
<script>

let task_name = "iBat1";
let urlP=getURLPars();

var timeline=[];
var N={
  ml: 2,
  pog: 2,
  flank: 30,
  tilt: 30,
  pz: 15
}

var run={
  ml: 1,
  pog: 1,
  tilt: 0,
  pz: 0,
  flank: 0
}

const globals={
  width: 1000,
  height: 500,
  cx: 500,
  cy: 250}

function finish(){
  DOM_target = document.querySelector('#jspsych-content');
  DOM_target.innerHTML = '<p style="font-size:200%;"><strong>Thank You<br> Do not close your browser</strong></p>';
  jsPsych.pluginAPI.cancelAllKeyboardResponses();
  jsPsych.pluginAPI.clearAllTimeouts();
}

var jsPsych = initJsPsych({
  on_finish: function() {
    save_data_csv(task_name,urlP);
    finish();
    //jsPsych.data.displayData();
    var timer = setTimeout(function() {
            window.location='debrief.html'
        }, 5000);
    }
});

var enter_fullscreen = {
  type: jsPsychFullscreen,
  fullscreen_mode: true
}
timeline.push(enter_fullscreen);

var preload = {
      type: jsPsychPreload,
      auto_preload: true
  }

timeline.push(preload);


timeline.push(insText('Hello\nPlease Make Sure You Can See The Black Rectangle\n\n(Space bar to continue)',globals));


timeline.push(insText('Ready to Start Task 1?\n\n(Space bar to continue)',globals));


if (run.ml){
  timeline.push(mlTrial(runLevel=0,globals));
  timeline.push(mlTrial(runLevel=1,globals));

  txt="We are going to do " + N.ml + " of these\nRemember, divide the line in half with arrow keys\n Use only your eyes for the judgment.\nREADY?\n(Press Space Bar To Continue)";
  
  timeline.push(insText(txt,globals));
  
  for (let i=0; i<N.ml;i++) {
    timeline.push(mlTrial(runLevel=2,globals))};
}

timeline.push(insText('Great.  You Finished Task 1\nReady To Start Task 2\n\n(Space bar to continue)',globals));

if (run.pog){
  timeline.push(pogTrial({targ:0,runLevel:0},globals));
  timeline.push(pogTrial({targ:0,runLevel:1},globals));
  timeline.push(pogTrial({targ:0,runLevel:2},globals));
  txt="We are going to do " + N.pog + " of these\nRemember, make the line straight with arrow keys\n Please use only your eyes for the judgment\nREADY?\n(Press Space Bar To Continue)";
  timeline.push(insText(txt,globals));

  for (let i=0; i<N.pog;i++) {
    timeline.push(pogTrial(
      {targ: getRandomInt(-40,40),runLevel: 3},globals))};
}

timeline.push(insText('Great.  You Finished Task 2\nReady To Start Task 3\n\n(Space bar to continue)',globals));


// tilt

if (run.tilt){
  timeline.push(tiltTrial({targ: 0,back: 0,runLevel: 0},globals));
  timeline.push(tiltTrial({targ: 0,back: 0,runLevel: 1},globals));
  timeline.push(tiltTrial({targ: 0,back: 0,runLevel: 2},globals));
  txt="We are going to do " + N.tilt + " of these\nRemember, match the angle to the inner patch\nPlease use only your eyes for the judgment\nREADY?\n(Press Space Bar To Continue)";
  timeline.push(insText(txt,globals));

  for (let i=0; i<N.tilt;i++) {
    timeline.push(tiltTrial({
        targ:getRandomInt(-10,10),
        back:getRandomInt(0,1),
        runLevel:3},
      globals))};
}

timeline.push(insText('Great.  You Finished Task 3\nReady To Start Task 4\n\n(Space bar to continue)',globals));


// ponzo
if (run.pz){
  timeline.push(pzTrial({targ: 50,runLevel: 0},globals));
  timeline.push(pzTrial({targ: 50,runLevel: 1},globals));
  timeline.push(pzTrial({targ: 30,runLevel: 2},globals));
  timeline.push(pzTrial({targ: 40,runLevel: 3},globals));
  txt="We are going to do " + N.pz + " of these\nRemember, match the height of the lines\nPlease use only your eyes for the judgment\nREADY?\n(Press Space Bar To Continue)";
  timeline.push(insText(txt,globals));
  for (let i=0; i<N.pz;i++) {
    timeline.push(pzTrial({
        targ:getRandomInt(20,60),
        runLevel:4},
      globals))};
}

// flank

timeline.push(insText('Great.  You Finished Task 4\nReady To Start The Last Task\n\n(Space bar to continue)',globals));



if (run.flank){
  timeline.push(insText('On the left there will be a box of characters\nFocus in on the middle one\n\n(Space bar to continue)',globals));
  timeline.push(flankTrial({targ: .3,back: 1,runLevel: 0},globals));
  timeline.push(insText('There is a character on the right\nAdjust it to match the middle character\nUse the left/right arrow keys\n\n(Space bar to continue)',globals));
  timeline.push(flankTrial({targ: .3,back: 1,runLevel: 1},globals));
  timeline.push(insText('The box on the left will be flashed rapidly\nSo please focus on the middle\nHere is an example:\n\n(Space bar to continue)',globals));
  timeline.push(flankTrial({targ: .3,back: 0,runLevel: 2},globals));
  txt="We are going to do " + N.flank + " of these\nRemember, match the characters\n\nREADY?\n(Press Space Bar To Continue)";
  timeline.push(insText(txt,globals));

  for (let i=0; i<N.flank;i++) {
    timeline.push(flankTrial({
        targ: (getRandomInt(10,40)*2)/100,
        back: getRandomInt(0,1),
        runLevel: 3},
      globals))};
}


var exit_fullscreen = {
  type: jsPsychFullscreen,
  fullscreen_mode: false,
  delay_after: 0
}
timeline.push(exit_fullscreen);

jsPsych.run(timeline);

</script>
</html>